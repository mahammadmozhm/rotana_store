# دليل قاعدة بيانات متجر روتانا

## نظرة عامة

هذا الدليل يوضح كيفية إعداد واستخدام قاعدة البيانات لمتجر روتانا الإلكتروني.

## الملفات المطلوبة

- `database_schema.sql` - ملف SQL يحتوي على جميع الجداول والبيانات الافتراضية
- `config/database.php` - ملف إعدادات الاتصال بقاعدة البيانات

## كيفية إعداد قاعدة البيانات

### الطريقة الأولى: استخدام phpMyAdmin

1. افتح phpMyAdmin في المتصفح
2. انقر على "New" لإنشاء قاعدة بيانات جديدة
3. أدخل اسم قاعدة البيانات: `rotana_store`
4. اختر Character Set: `utf8mb4_unicode_ci`
5. انقر على "Create"
6. اختر قاعدة البيانات الجديدة
7. انقر على تبويب "SQL"
8. انسخ محتوى ملف `database_schema.sql` والصقه
9. انقر على "Go" لتنفيذ الأوامر

### الطريقة الثانية: استخدام سطر الأوامر

```bash
# الدخول إلى MySQL
mysql -u root -p

# إنشاء قاعدة البيانات
CREATE DATABASE rotana_store CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# الخروج من MySQL
exit

# استيراد الملف
mysql -u root -p rotana_store < database_schema.sql
```

### الطريقة الثالثة: استخدام ملف config/database.php

1. تأكد من أن ملف `config/database.php` يحتوي على الإعدادات الصحيحة
2. افتح المتجر في المتصفح
3. سيتم إنشاء قاعدة البيانات تلقائياً عند أول زيارة

## هيكل قاعدة البيانات

### الجداول الأساسية

#### 1. جدول المستخدمين (`users`)
- **الغرض**: تخزين بيانات المديرين والمستخدمين
- **الحقول المهمة**:
  - `username`: اسم المستخدم (فريد)
  - `password`: كلمة المرور (مشفرة)
  - `role`: دور المستخدم (admin, manager, editor)
  - `is_active`: حالة الحساب

#### 2. جدول الفئات (`categories`)
- **الغرض**: تصنيف المنتجات
- **الحقول المهمة**:
  - `name`: اسم الفئة
  - `slug`: الرابط المختصر
  - `icon`: أيقونة FontAwesome
  - `sort_order`: ترتيب العرض

#### 3. جدول المنتجات (`products`)
- **الغرض**: تخزين بيانات المنتجات
- **الحقول المهمة**:
  - `title`: عنوان المنتج
  - `price`: السعر
  - `image_url`: رابط صورة المنتج
  - `stock_quantity`: الكمية المتوفرة
  - `is_featured`: منتج مميز

#### 4. جدول الإعدادات (`settings`)
- **الغرض**: إعدادات المتجر العامة
- **الحقول المهمة**:
  - `setting_key`: مفتاح الإعداد
  - `setting_value`: قيمة الإعداد
  - `setting_type`: نوع البيانات

#### 5. جدول النشاطات (`activities`)
- **الغرض**: تسجيل نشاطات المديرين
- **الحقول المهمة**:
  - `action`: نوع النشاط
  - `description`: وصف النشاط
  - `ip_address`: عنوان IP

### الجداول الإضافية

#### 6. جدول الطلبات (`orders`)
- **الغرض**: تخزين طلبات العملاء
- **الحقول المهمة**:
  - `order_number`: رقم الطلب
  - `customer_name`: اسم العميل
  - `customer_phone`: رقم الهاتف
  - `total_amount`: المبلغ الإجمالي
  - `status`: حالة الطلب

#### 7. جدول تفاصيل الطلبات (`order_items`)
- **الغرض**: تفاصيل المنتجات في كل طلب
- **الحقول المهمة**:
  - `order_id`: معرف الطلب
  - `product_id`: معرف المنتج
  - `quantity`: الكمية
  - `unit_price`: سعر الوحدة

#### 8. جدول العملاء (`customers`)
- **الغرض**: قاعدة بيانات العملاء
- **الحقول المهمة**:
  - `name`: اسم العميل
  - `phone`: رقم الهاتف
  - `email`: البريد الإلكتروني
  - `total_orders`: إجمالي الطلبات
  - `total_spent`: إجمالي الإنفاق

#### 9. جدول العروض (`discounts`)
- **الغرض**: إدارة العروض والخصومات
- **الحقول المهمة**:
  - `title`: عنوان العرض
  - `discount_type`: نوع الخصم (نسبة أو مبلغ ثابت)
  - `discount_value`: قيمة الخصم
  - `start_date`: تاريخ البداية
  - `end_date`: تاريخ النهاية

#### 10. جدول الإشعارات (`notifications`)
- **الغرض**: إشعارات المديرين
- **الحقول المهمة**:
  - `title`: عنوان الإشعار
  - `message`: محتوى الإشعار
  - `type`: نوع الإشعار
  - `is_read`: تم القراءة أم لا

## البيانات الافتراضية

### المستخدم الافتراضي
- **اسم المستخدم**: `admin`
- **كلمة المرور**: `rotana123`
- **البريد الإلكتروني**: `admin@rotana.com`
- **الدور**: `admin`

### الفئات الافتراضية
1. **اللابتوبات** - أجهزة الكمبيوتر المحمولة
2. **الهواتف** - الهواتف الذكية
3. **الاكسسوارات** - ملحقات الأجهزة

### المنتجات الافتراضية
- **6 لابتوبات** مختلفة (HP, Dell, Lenovo, ASUS, Acer, MacBook)
- **8 هواتف** مختلفة (iPhone, Samsung, Huawei, Xiaomi, Oppo, OnePlus)
- **12 اكسسوار** مختلفة (سماعات, شواحن, حافظات, إلخ)

### الإعدادات الافتراضية
- اسم المتجر: روتانا
- العملة: د.ع (دينار عراقي)
- رقم الواتساب: +9647501234567
- أنواع الصور المسموحة: jpg, jpeg, png, gif, webp
- الحد الأقصى لحجم الملف: 5MB

## الأمان والنسخ الاحتياطي

### تغيير كلمة المرور الافتراضية
```sql
UPDATE users 
SET password = '$2y$10$' || MD5(RAND()) || 'new_password_hash' 
WHERE username = 'admin';
```

### إنشاء نسخة احتياطية
```bash
mysqldump -u root -p rotana_store > backup_$(date +%Y%m%d_%H%M%S).sql
```

### استعادة نسخة احتياطية
```bash
mysql -u root -p rotana_store < backup_file.sql
```

## تحسين الأداء

### الفهارس المضافة
- فهارس على `category_id` في جدول المنتجات
- فهارس على `status` و `created_at` في جدول الطلبات
- فهارس على `user_id` و `action` في جدول النشاطات
- فهارس على `phone` و `email` في جدول العملاء

### نصائح إضافية
1. قم بتشغيل `OPTIMIZE TABLE` دورياً
2. احذف النشاطات القديمة بانتظام
3. اضغط الصور قبل رفعها
4. استخدم CDN للصور في الإنتاج

## استكشاف الأخطاء

### مشاكل شائعة

#### 1. خطأ في الاتصال
```php
// تأكد من إعدادات config/database.php
$host = 'localhost';
$dbname = 'rotana_store';
$username = 'root';
$password = 'your_password';
```

#### 2. خطأ في الترميز
```sql
-- تأكد من إعداد الترميز
SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;
```

#### 3. خطأ في الصلاحيات
```sql
-- منح الصلاحيات للمستخدم
GRANT ALL PRIVILEGES ON rotana_store.* TO 'username'@'localhost';
FLUSH PRIVILEGES;
```

## الدعم

إذا واجهت أي مشاكل في قاعدة البيانات، يمكنك:
1. مراجعة ملف `config/database.php`
2. التحقق من سجلات الخطأ في MySQL
3. التأكد من إعدادات phpMyAdmin
4. مراجعة هذا الدليل مرة أخرى 